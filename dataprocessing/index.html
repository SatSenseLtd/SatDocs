
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.5.2">
    
    
      
        <title>Overview - SatDocs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9f9400aa.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#ef5552">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SatDocs" class="md-header__button md-logo" aria-label="SatDocs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SatDocs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SatDocs" class="md-nav__button md-logo" aria-label="SatDocs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SatDocs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        SatSense Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../AWS/" class="md-nav__link">
        Setting up AWS for processing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../daemon/" class="md-nav__link">
        SatDaemon (SQLAlchemy Version)
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Overview
      </a>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../jira/" class="md-nav__link">
        Jira
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sftp_user_setup/" class="md-nav__link">
        Sftp user setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Client facing applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Client facing applications" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Client facing applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/admin/" class="md-nav__link">
        Admin Suite (satadmin)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/api/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/database/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/demo-portal/" class="md-nav__link">
        Demo portal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/geoserver/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/overview/" class="md-nav__link">
        SatSense Client-Facing Applications Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/portal/" class="md-nav__link">
        Portal/SatShop (satportal)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/satdes/" class="md-nav__link">
        Satdes (Data Extraction Service)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/satdom-scripts/" class="md-nav__link">
        Satdom Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/satpgi/" class="md-nav__link">
        Postgres Ingester (satpgi)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/tileserver-qgis-fiddle/" class="md-nav__link">
        Integrating Tileservers into QGIS (fiddle)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/tileservers/" class="md-nav__link">
        Tileservers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/webmisc/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/what-mike-does/" class="md-nav__link">
        "What Mike does"
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_15" type="checkbox" id="__nav_7_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_15">
          Portal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Portal" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_15">
          <span class="md-nav__icon md-icon"></span>
          Portal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../client-facing-applications/portal/portal-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="overview">Overview</h1>
<p>The SatSense InSAR processing chain consists of four main steps:
1. SatSAR: Ingest SAR data from archive and generate single-master interferograms.
2. RapidSAR: Coherence estimation and unwrapping of interferograms.
3. Time-series inversion: Cumulative displacement time-series and velocity.
4. Post-processing: Multiple filtering steps to reduce noise and mitigate signals from tropospheric delays.</p>
<h1 id="satsar">SatSAR</h1>
<p>SatSAR is an interferometric software package developed by SatSense, originally derived from <a href="https://gitlab.com/LiCS/LiCSAR/">LiCSAR</a>. SatSAR uses the <a href="https://www.gamma-rs.ch/no_cache/software.html">Gamma</a> SAR processor as a backend to ingest SAR data from archive, and is developed predominntly in Python. The package is currently undergoing a re-organisation, so this page is subject to change.</p>
<h2 id="package-organisation">Package organisation</h2>
<p>The batch processing to form interferograms consists of three main steps:
1. <a href="https://gitlab.com/SatSenseLtd/SatSAR/blob/master/bin/make_images.py">make_images.py</a>
2. <a href="https://gitlab.com/SatSenseLtd/SatSAR/blob/master/bin/coreg.py">coreg.py</a>
3. <a href="https://gitlab.com/SatSenseLtd/SatSAR/blob/master/bin/make_interferograms.py">make_interferograms.py</a></p>
<h3 id="gamma-functions">Gamma functions</h3>
<p>The four-step scripts described above act as the front end to the processor. Under the hood, they use the Gamma SAR processor: <a href="https://gitlab.com/SatSenseLtd/SatSAR/blob/master/python/gamma_functions.py">gamma_functions</a> module. The function names in this module correspond one-to-one to Gamma functions, and more documentation on them can be found in the Gamma manual.</p>
<h3 id="database-integration">Database integration</h3>
<p>The Sentinel-1 satellite acquires data in bursts and swaths. To keep track of these, SatSAR can be run using input files (polygon and ziplist), or using the database. The queries into the database are contained in the <a href="https://gitlab.com/SatSenseLtd/satdaemon/-/blob/master/database/dbquery.py">satdaemon dbquery</a> module.</p>
<h2 id="processing-directory-structure">Processing directory structure</h2>
<p>A typical SatSAR working directory will contain a number of directories. Below is a description of the main directories:</p>
<h3 id="dem">DEM</h3>
<p>The DEM directory contains the Digital Elevation Model necessary for processing. This can be created using the <a href="https://gitlab.com/SatSenseLtd/SatSAR/-/blob/master/scripts/mk_srtm2insar">mk_srtm2insar</a> script. You can use whatever DEM you want, but <em>the files must be named as listed in the table!</em> Below is a table of files that should be in the DEM directory.
| File         | Description |
|--------------|-------------|
| dem_crop.dem | Binary file containing the DEM heights |
| dem_crop.dem_par | Parameter file associated with the DEM |
| dem_crop.dem.ras | Sunraster preview of the DEM |</p>
<h3 id="geo">geo</h3>
<p>The <em>geo</em> directory contains files related to the sensing geometry, like height of every point, latitude, longitude and look angles. Below is a list of important files in this directory.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[Masterdate].hgt</td>
<td>Binary file containing the height of every point in the master MLI/IFG</td>
</tr>
<tr>
<td>[Masterdate].lat</td>
<td>Binary file containing the latitude of every point in the master MLI/IFG</td>
</tr>
<tr>
<td>[Masterdate].lon</td>
<td>Binary file containing the longitude of every point in the master MLI/IFG</td>
</tr>
<tr>
<td>[Masterdate].lt</td>
<td>Complex binary file containing Lookup table between the master MLI and EQA.dem</td>
</tr>
<tr>
<td>EQA.dem</td>
<td>Binary file containing a crop of the DEM fitted to the processed scene</td>
</tr>
</tbody>
</table>
<p>Most of these files have associated preview and/or parameter files. There are quite a few other files in the directory, but you're less likely to need to know about them. All of the above files are created during <a href="https://gitlab.com/SatSenseLtd/SatSAR/blob/master/bin/coreg.py">coregistration</a>, except for the lat and lon files, which are created during post-processing using a separate <a href="https://gitlab.com/SatSenseLtd/SatSAR/-/blob/master/bin/get_lonlat.py">script</a>.</p>
<h3 id="ifg">IFG</h3>
<p>The IFG directory contains files related to interferograms. Within this directory, there are two options for the directory structure, depending on the chosen method during processing. Usually, inside the IFG directory, there will be a singlemaster directory. Inside here, there is a directory for every combinations formed, which will be one combination for each slave image. The other option is that you find combinations directly in the IFG directory. This means that the short temporal baseline combination was chosen, and the number of combinations per image depends on the maximum combination parameter that was used.</p>
<p>Whichever method is used, the files inside each combination directory looks the same.
| File | Description |
|------|-------------|
|[combination].diff | Wrapped, unfiltered interferogram |
|[combination].sim_unw | Estimated topographic phase |</p>
<h3 id="slc">SLC</h3>
<p>Single Look Complex data. This will only contain the master directory, apart from during the SLC generation.</p>
<h3 id="rslc">RSLC</h3>
<p>Registered Single Look Comple data, contains dtaa for each image/acquisition.</p>
<p><em>Note that there are several additional auxillary directories also created.</em></p>
<h2 id="tutorial">Tutorial</h2>
<p>At the end of this tutorial you will have:
1. Setup software modules including the SatSAR module
2. Learned basic SatSAR workflow
3. Used SatSAR to process a test frame</p>
<p>Some acronyms/terms used throughout this tutorial:
| Item        | Description                                                    |
| ----------- | -----------                                                  <br />
| SatSAR      | The version of LiCSAR used by SatSense LTD.                    | 
| Gamma       | Commercial software used for various stages of InSAR processing.                </p>
<p><strong>Throughout the tutorial, wherever you see text between arrows:</strong></p>
<pre><code class="language-shell">&lt;LIKE_THIS&gt;
</code></pre>
<p><strong>This refers to somewhere you are required to provide an input in a bash terminal, or (<code>python</code>) terminal (if speficied).</strong></p>
<h3 id="obtaining-your-own-local-version-of-satsar">Obtaining your own local version of SatSAR</h3>
<p>First, obtain an ssh key for GitLab by following the instructions here:<br />
https://docs.gitlab.com/ee/gitlab-basics/create-your-ssh-keys.html<br />
Instructions to generate your ssh key can be found here:<br />
https://docs.gitlab.com/ee/ssh/README.html  </p>
<p>Following this, go to the area you wish to set up your local version of SatSAR, for example:</p>
<pre><code class="language-shell">cd &lt;PATH_TO_YOUR_CLONE_LOCATION&gt;
</code></pre>
<p>e.g.</p>
<pre><code class="language-shell">cd /home/karsten/
</code></pre>
<p>Activate your ssh key (create with ssh-keygen if necessary):</p>
<pre><code class="language-shell">ssh-agent $SHELL
</code></pre>
<pre><code class="language-shell">ssh-add ~/.ssh/&lt;keyname&gt;
</code></pre>
<p>Note that you have to do this every time you want to interact with the remote repository.</p>
<p>Now, go to the SatSAR GitLab page (https://gitlab.com/SatSenseLtd/SatSAR) and copy the SSH URL found at the top of the page (you may need to swap to SSH from HTTPS using the drop down box). Clone the remote GitLab repository to your local system:</p>
<pre><code class="language-shell">git clone &lt;GITLAB_URL&gt;
</code></pre>
<p>The following should work with the current SatSAR URL:</p>
<pre><code class="language-shell">git clone git@gitlab.com:SatSenseLtd/SatSAR.git
</code></pre>
<p>We will also need the satdaemon repository, which is also on gitlab. Navigate here, and clone it from the same location as you did for SatSAR.</p>
<h3 id="setting-up-satsar">Setting up SatSAR</h3>
<p>SatSAR uses Gamma, implemented within the SatSense software written in python. In order to begin processing, you need to set up the appropriate software. At SatSense, we have Gamma and python installed as modules or applications. Begin by setting these up using:</p>
<pre><code class="language-shell">module load canopy python-libs gamma/20180704
</code></pre>
<p>This will import various python modules and set up Gamma as required for processing. </p>
<p>Next, source the LiCSAR software. There is already a LiCSAR_source.sh file in your local SatSAR folder, which should be copied to a different location and updated as follows:</p>
<pre><code class="language-shell">LiCSARpath=&lt;PATH_TO_YOUR_SATSAR_FOLDER&gt;
</code></pre>
<p>e.g.</p>
<pre><code class="language-bash">LiCSARpath=/home/karsten/SatSAR
</code></pre>
<p>Source your updated LiCSAR_source.sh file:</p>
<pre><code class="language-shell">source &lt;PATH_TO_YOUR_CONFIG_FILE&gt;/LiCSAR_source.sh
</code></pre>
<p>e.g.</p>
<pre><code class="language-shell">source /home/karsten/LiCSAR_source.sh
</code></pre>
<p><strong> You could put these commands in your bashrc/cshrc file such that they run when you load a new terminal </strong>  </p>
<p>Finally, make an empty folder entitled "temp" and then make a new environmental variable ,$LiCSAR_temp,  in your bashrc/cshrc file, by adding the following command:</p>
<pre><code class="language-shell">export LiCSAR_temp=&quot;&lt;PATH_TO_YOUR_TEMP&gt;&quot;
 ```
e.g.
```shell
export LiCSAR_temp=/home/karsten/temp
</code></pre>
<h3 id="using-satsar-on-the-satsense-virtual-machines">Using SatSAR on the SatSense Virtual Machines</h3>
<p>This will take you through getting started processing on the Virtual Machines (VM). There are currently two virtual machines (VM3 and VM4) at SatSense for processing. This also requires a <em>.bashrc</em> file with correct paths and loading the satsense_live conda environment.</p>
<p>To access the virtual machines from your local Ubuntu terminal:</p>
<pre><code class="language-shell">ssh -X -p 2223 user@93.93.133.78
ssh -X -p 2222 user@93.93.133.78
</code></pre>
<p>Now you are on the virtual machine, check the data storage availability on the rust disks (rust0 to 3, 115 TB each) prior to starting processing:</p>
<pre><code class="language-shell">df -h
</code></pre>
<p>Set the emptiest of these to store the downloaded files through the intial processing stages:</p>
<pre><code class="language-shell">RUSTDIR=rust0
echo $RUSTDIR
</code></pre>
<p>Downloaded SAR data is stored in:</p>
<pre><code class="language-shell">/data/
</code></pre>
<p>Any subsequent frame products are stored in:</p>
<pre><code class="language-shell">/workspace/frames/
</code></pre>
<p>When processing, login to centos (root privelidges account):</p>
<pre><code class="language-shell">sudo su centos
</code></pre>
<p>If using the database for frame processing (<code>python</code>):</p>
<pre><code class="language-shell">from dbquery import Database
from dbquery import Frame
dbq = Database()
</code></pre>
<p>Several of the following steps take a while to run so do this in a <code>screen</code>:</p>
<pre><code class="language-shell">screen -S proc_guide
</code></pre>
<h3 id="directory-set-up-and-data-download">Directory set-up and data download</h3>
<p>Prior to dowloading data, check if a track data directory already exists (e.g. T000, from pre-existing defined frames).</p>
<pre><code class="language-shell">TRACK=000
ORB=D
ls /data/T${TRACK}
</code></pre>
<p>If not, create this in the data directory of the rust disk which has the most remaining space.</p>
<pre><code class="language-shell">cd /${RUSTDIR}/data/
mkdir T${TRACK}
</code></pre>
<p>The data directory must now be linked to rust2.</p>
<pre><code class="language-shell">cd /rust2/data/
ln -s /${RUSTDIR}/data/${TRACK} .
</code></pre>
<p>Similarly we need to create a frame processing directory for processing. Framenames are self defined but must contain the track name and orbit, and then two additional strings separated by underscores (e.g. 000A_UK_131313). The second string can be used to direct the user to the location (either name or colatitude), whilst the third string is typically used to inform a user of the number of bursts in each subswath within the frame (see ASF/SciHub/QGIS).</p>
<p>If you want make typing things in easier, set a bash environment variable for the framename:</p>
<pre><code class="language-shell">FRAMENAME=${TRACK}${ORB}_UK_131313
echo $FRAMENAME
cd /${RUSTDIR}/workspace/frames/
mkdir $FRAMENAME
</code></pre>
<p>The frame directory must now be linked to the rust2 workspace directory.</p>
<pre><code class="language-shell">cd /rust2/workspace/frames/
ln -s /${RUSTDIR}/workspace/frames/${FRAMENAME} .
</code></pre>
<p>To set up a frame in the database (<code>python</code>):</p>
<pre><code class="language-shell">fid = '000A_UK_131313'
bl = ['000_12345_IW1', '000_12345_IW2', '000_12345_IW3']
dbq.make_new_frame_using_burstlist(bl, fid)
</code></pre>
<p>To check the set-up is succesful, try (<code>python</code>):</p>
<pre><code class="language-shell">frame = dbq.query(Frame, id=fid)[0]
print(frame.id, frame.track)
</code></pre>
<p>If using the frame database for processing, it is good practice to update the database with the data download location (<code>python</code>).</p>
<pre><code class="language-shell">dbq.update(Frame, {'downloaddir':'/data/T000'}, id=fid)
</code></pre>
<p>Now download some data (replace input flags). Once the data has been unzipped, remember to delete the zip files to save memory on the virtual machines.</p>
<pre><code class="language-shell">master_download_script.py -f $FRAMENAME -d /data/T${TRACK}/
</code></pre>
<p>The MASTERDATE is now defined if using the database (<code>python</code>):</p>
<pre><code class="language-shell">frame = dbq.query(Frame, id=fid)[0]
frame.master[0].date.strftime('%Y%m%d')
</code></pre>
<pre><code class="language-shell">MASTERDATE=YYYYMMDD
echo $MASTERDATE
</code></pre>
<p>The final remaining step prior to processing is to create a DEM. Within the frame directory:</p>
<pre><code class="language-shell">cd /workspace/frames/$FRAMENAME
make_frame_dem.py -d /data/SRTM -f $FRAMENAME -o DEM
</code></pre>
<p>Check the .bmp file in the output directory to confirm the DEM is correct (<code>eog DEM/*.bmp</code>).</p>
<h3 id="processing-overview">Processing overview</h3>
<p>Now that SatSAR has been set up, you can start using it. The commands for each stage of the processing are summarised below:</p>
<pre><code class="language-shell">make_images.py -d `pwd` -f $FRAMENAME -m $MASTERDATE
coreg.py -d `pwd` -f $FRAMENAME -m $MASTERDATE
make_interferograms.py -d `pwd` -f $FRAMENAME -s
</code></pre>
<p>A summary of the input argument placeholders:
| Placeholder | Description                                                    |
| ----------- | -----------                                                    |
| WORKDIR     | Working directory for the frame processing (<code>pwd</code>)             |
| FRAMENAME   | The name of the frame you want to process
| MASTERDATE  | The master date                                                |</p>
<h1 id="rapidsar-time-series-processing">RapidSAR time-series processing</h1>
<p>Following the initial single-master processing with SatSAR, we now run the rest of the time-series processing with RapidSAR. Within the processing directory, create a RapidSAR working directory. It is also worth running these commands in a <code>screen</code> as they can take a while.</p>
<pre><code class="language-shell">mkdir RapidSAR
</code></pre>
<p>Prior to running the ingest step of RapidSAR, we need to generate some files in the <code>geo</code> directory:</p>
<pre><code class="language-shell">get_lonlat.py -d `pwd` -f $FRAMENAME
get_look_angles.py -d `pwd` -f $FRAMENAME
</code></pre>
<p>If cropping the data down prior to running the time-series analysis, at this stage run (and use the output during the RapidSAR ingestion, also recommend saving to text file for future reference):</p>
<pre><code class="language-shell">get_lonlatbounds_shp.py -s .shp
get_crop_area.py -d `pwd` -p top,bottom,left,right
</code></pre>
<p>To ingest the processed data into RapidSAR, run:</p>
<pre><code class="language-shell">RapidSAR_ingest.py RSLC IFG data.h5 -f $FRAMENAME [-c top,bottom,left,right]
</code></pre>
<p>There will now be a single data.h5 file in the directory (to list its contents: <code>h5ls data.h5</code>).</p>
<h2 id="coherence-estimation">Coherence estimation</h2>
<p>The next step is to use the sibling coherence method to accurately estimate the coherence on a pixel. Previous measures use a window surrounding the pixel to estimate the coherence. However this estimation breaks down if pixels are adjacent to non-similar pixels (e.g. the edge of buildings). Instead the sibling method identifies similar points within the image (up to 100 siblings per pixel) and uses these to estimate the coherence.</p>
<pre><code class="language-shell">RapidSAR_find_siblings.py RSLC IFG data.h5 Coherence -f $FRAMENAME
</code></pre>
<p>This creates a .shp file (statistically homegenous pixels, i.e. siblings, not a QGIS format...) and a coh.h5 file. For more details on the sibling coherence method, see: <em>Spaans K, Hooper A. InSAR processing for volcano monitoring and other near‐real time applications (2016). JGR Solid Earth</em>.</p>
<h2 id="unwrapping">Unwrapping</h2>
<p>For the unwrapping, we use the algorithm/program SNAPHU (Chen and Zebker, Stanford). This converts wrapped phase (-π to π) to continuous unwrapped phase (also in radians). The [-c] flag is the phase variance threshold (any pixels above this are considered noise).</p>
<pre><code class="language-shell">RapidSAR_unwrap.py IFG Coherence data.h5 RSLC -f $FRAMENAME
</code></pre>
<p>This process creates a file uw.h5 within the RapidSAR directory. The uw.h5 file contains two unwrapped datasets. The first is the "high resolution" (full) unwrapped interferograms. The second is the lower resolution "rural" dataset. The rural dataset is multi-looked (downsampled) with 3 looks in range and 12 looks in azimuth (Sentinel-1 data is acquired in non-square pixels, this ratio converts to approximately square). </p>
<p>The rural data has a more coarse resolution which makes it easier to handle (look at the differences in file size of the output velocity maps in the next step). The pixel size is approximately 50 m × 50 m. There is currently an issue with rural datasets in that they are affected by fading phase-bias (see: <em>Ansari, H., De Zan, F. and Parizzi, A. Study of Systematic Bias in Measuring Surface Deformation with SAR Interferometry (2020) IEEE</em>). The source of the bias remains unknown, however it results in the apparent subsidence of rural pixels and is more pronounced in short temporal baseline interferograms.</p>
<h2 id="time-series-inversion">Time-series inversion</h2>
<p>The time-series inversion is run on both the rural and high-resolution datasets. An overly simplified description of the time-series inversion is that it is solving a least-squares inversion for the displacement of each image relative to the first date in the time-series, from the network phase displacements in each interferogram in the interferometric network. This generates a displacement time-series which can then be used to derive the average velocity of each pixel in the line-of-sight (LOS). In practice this is more complex, including referencing the time-series in space and time, running the inversion multiple times to detect unwrapping errors, and mapping out islands in the track extent using the DEM. We run this in two stages (rural resolution, then full resolution):</p>
<pre><code class="language-shell">multicore_ts.py Coherence data.h5 ${FRAMENAME}-rural-vel.h5 -f $FRAMENAME -l
multicore_ts.py Coherence data.h5 ${FRAMENAME}-vel.h5 -f $FRAMENAME -z ${FRAMENAME}-rural-vel.h5
</code></pre>
<h2 id="post-processing">Post-processing</h2>
<pre><code class="language-shell">multicore_postproc.py -d ${FRAMENAME}-rural-vel.h5 -i ${FRAMENAME}-vel.h5 -p data.h5 -f $FRAMENAME
</code></pre>
<p>SatSense 'standard' post-processing applies several steps to the "Cumulative_Displacement" dataset to create new datasets in the <code>*-vel.h5</code> files.
* Remove long-wavelength signals with a 30 km Gaussian filter ("Cumulative_Displacement_Filt").
* APS filter: using the assumption that atmosphere should be random in time (high-pass) but correlated in space (low-pass)("Cumulative_Displacement_APS").
* Smooth displacement time-series in time using a triangular weighted smoothing ("Cumulative_Displacement_TSmooth").</p>
<p>This also calculates the RMS error for the time-series. It is possible to skip options with flags (use input "SKIP"), however then watch out for default inputs in subsequent steps.</p>
<p>An additional required post-processing step is the reliable pixels estimation. This recognises pixels affected by rural bias and removes them. To run this:</p>
<pre><code class="language-shell">get_reliable_pixels.py -d ${FRAMENAME}-rural-vel.h5 -i ${FRAMENAME}-vel.h5 -p data.h5 -f 0
</code></pre>
<h2 id="data-export-to-qgis">Data export to QGIS</h2>
<p>After this, it is possible to generate shapefiles for export to QGIS:</p>
<pre><code class="language-shell">rsar_extract.py -d ${FRAMENAME}-vel.h5 -e data.h5 -o $FRAMENAME -r REF.shp -p linear,seasonal
rsar_extract.py -d ${FRAMENAME}-rural-vel.h5 -e data.h5 -o ${FRAMENAME}_RURAL -r REF.shp -p linear,seasonal
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../daemon/" class="md-footer__link md-footer__link--prev" aria-label="Previous: SatDaemon (SQLAlchemy Version)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              SatDaemon (SQLAlchemy Version)
            </div>
          </div>
        </a>
      
      
        
        <a href="../jira/" class="md-footer__link md-footer__link--next" aria-label="Next: Jira" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Jira
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.39f04ddb.min.js"></script>
      
    
  </body>
</html>